!function(){"use strict";var e=window.wp.element,t=(window.wp.plugins,window.wp.data),o=window.wp.blocks,r=window.wp.coreData,a=window.wp.editor,n=window.wp.editPost;function d(d){let{categoriesById:i}=d;const{post:s,isCurrentPostPublished:c,isCurrentPostScheduled:l}=(0,t.useSelect)((e=>{const t=e(a.store),o=e(r.store);return{post:t.getCurrentPost(),isCurrentPostPublished:t.isCurrentPostPublished(),isCurrentPostScheduled:t.isCurrentPostScheduled(),categories:o.getEntityRecords("taxonomy","category",{per_page:-1,orderby:"name",order:"asc",_fields:"id,name,parent",context:"view"})||[]}})),m=(0,t.useSelect)((e=>({status:e(a.store).getEditedPostAttribute("status"),title:e(a.store).getEditedPostAttribute("title"),categories:e(a.store).getEditedPostAttribute("categories")}))),{editEntityRecord:u,saveEditedEntityRecord:w}=(0,t.useDispatch)(r.store),{editPost:_}=(0,t.useDispatch)(a.store);(0,e.useEffect)((()=>{var e;return s&&(window.CommandBar.addContext("WP_core-editor_currentPost",s),window.CommandBar.addContext("WP_core-editor_currentPost_hasPublishAction",Boolean(null===(e=s._links)||void 0===e?void 0:e["wp:action-publish"])),window.CommandBar.addContext("WP_core-editor_currentPost_canSwitchToDraft",c||l)),()=>{window.CommandBar.removeContext("WP_core-editor_currentPost"),window.CommandBar.removeContext("WP_core-editor_currentPost_hasPublishAction"),window.CommandBar.removeContext("WP_core-editor_currentPost_canSwitchToDraft")}}),[s,c,l]),(0,e.useEffect)((()=>{if(m){const e=m.categories;window.CommandBar.addContext("WP_core-editor_editedPostAttributes",m),e&&window.CommandBar.addContext("WP_core-editor_editedPostAttributes_categories",e.map((e=>i[e])))}return()=>{window.CommandBar.removeContext("WP_core-editor_editedPostAttributes"),window.CommandBar.removeContext("WP_core-editor_editedPostAttributes_categories")}}),[m]),(0,e.useEffect)((()=>(window.CommandBar.addCallback("WP_currentPost_edit",((e,t)=>{u("postType",s.type,s.id,e)})),window.CommandBar.addCallback("WP_currentPost_publish",(async(e,t)=>{e.date&&u("postType",s.type,s.id,{date:e.date}),u("postType",s.type,s.id,{status:"future"}),await w("postType",s.type,s.id)})),window.CommandBar.addCallback("WP_currentPost_switchToDraft",(async(e,t)=>{u("postType",s.type,s.id,{status:"draft"}),await w("postType",s.type,s.id)})),()=>{window.CommandBar.removeCallback("WP_currentPost_edit"),window.CommandBar.removeCallback("WP_currentPost_publish"),window.CommandBar.removeCallback("WP_currentPost_switchToDraft")})),[s,u,w]),(0,e.useEffect)((()=>(window.CommandBar.addCallback("WP_currentPost_insertBlock_image",((e,r)=>{const{attachment:a,alt:n,caption:d}=e,{index:i,rootClientId:s}=(0,t.select)("core/block-editor").getBlockInsertionPoint();(0,t.dispatch)("core/block-editor").insertBlock((0,o.createBlock)("core/image",{url:a.attachment_url,alt:n,caption:d}),i,s)})),()=>{window.CommandBar.removeCallback("WP_currentPost_insertBlock_image")})),[]),(0,e.useEffect)((()=>(window.CommandBar.addCallback("WP_currentPost_setCategories",((e,t)=>{e.categories&&_({categories:e.categories.map((e=>e.id))})})),()=>{window.CommandBar.removeCallback("WP_currentPost_setCategories")})),[_]);const{__experimentalSetPreviewDeviceType:P}=(0,t.useDispatch)(n.store),p=(0,t.useSelect)((e=>e(n.store).__experimentalGetPreviewDeviceType()));return(0,e.useEffect)((()=>(window.CommandBar.addCallback("WP_core-edit-post_setPreviewDeviceType",((e,t)=>{var o;const r=(null==e||null===(o=e.record)||void 0===o?void 0:o.value)||"Desktop";P(r)})),window.CommandBar.addContext("WP_core-edit-post_previewDeviceType",p),()=>{window.CommandBar.removeCallback("WP_core-edit-post_setPreviewDeviceType"),window.CommandBar.removeContext("WP_core-edit-post_previewDeviceType")})),[P,p]),null}function i(t){let{categoriesById:o}=t;return(0,e.useEffect)((()=>(window.CommandBar.addContext("WP_core_categories",Object.values(o)),()=>{window.CommandBar.removeContext("WP_core_categories")})),[o]),(0,e.useEffect)((()=>(window.CommandBar.addCallback("WP_post_edit",(async(e,t)=>{const{post:o,record:r,...a}=e,n=o||r;if(!n)return!1;const d=new wp.api.models.Post({id:n.id});return Object.entries(a).forEach((e=>{let[t,o]=e;console.log("Edits: ",t,o),d.set(t,o)})),d.save(),!0})),()=>{window.CommandBar.removeCallback("WP_post_edit")})),[]),null}ReactDOM.render((0,e.createElement)((function(){const o=(0,t.useSelect)((e=>{var t;return null!=(null===(t=e(a.store).getCurrentPost())||void 0===t?void 0:t.id)})),n=(0,t.useSelect)((e=>e(r.store).getEntityRecords("taxonomy","category",{per_page:-1,orderby:"name",order:"asc",_fields:"id,name,parent",context:"view"})))||[],s=(0,e.useMemo)((()=>{let e={},t={};n.forEach((t=>e[t.id]=t));let o=n.map((t=>{let o=t,r=[t.name];for(;e[o.parent];)r.unshift(e[o.parent].name),o=e[o.parent];return{...t,label:r.join(" / ")}}));return o=[...o].sort(((e,t)=>"Uncategorized"===e?1:"Uncategorized"===t?-1:e.label.localeCompare(t.label))),o.forEach((e=>t[e.id]=e)),t}),[n]);return(0,e.createElement)(e.Fragment,null,o&&(0,e.createElement)(d,{categoriesById:s}),(0,e.createElement)(i,{categoriesById:s}))}),null),document.createElement("div"))}();